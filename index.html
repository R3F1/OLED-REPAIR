<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>OLED REPAIR v11.0 PRINT MASTER</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700&family=Roboto:wght@400;500;700&display=swap&subset=latin-ext" rel="stylesheet">
  
  <style>
    /* --- CONFIG & VARIABLES --- */
    :root {
      --bg-deep: #050505;
      --panel-glass: rgba(20, 25, 35, 0.95);
      --neon-cyan: #00f3ff;
      --neon-green: #0aff00;
      --neon-red: #ff003c;
      --neon-gold: #ffd700;
      --neon-purple: #bc13fe;
      --font-ui: 'Roboto', sans-serif;
      --font-tech: 'Oxanium', cursive;
    }
    
    * { box-sizing: border-box; }
    
    body {
      margin: 0; background-color: var(--bg-deep); color: #fff;
      font-family: var(--font-ui); height: 100vh; overflow: hidden;
      display: flex; flex-direction: column;
      background-image: linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
    }

    /* --- PRINT STYLES (ETIKIETA) --- */
    @media print {
      body * { visibility: hidden; } /* Ukryj wszystko */
      #printableLabel, #printableLabel * { visibility: visible; } /* Poka≈º tylko etykietƒô */
      
      #printableLabel {
        position: fixed; left: 0; top: 0;
        width: 100%; height: 100%;
        background: white; color: black;
        display: flex !important; flex-direction: column;
        align-items: center; justify-content: center;
        border: 4px solid black; /* Ramka etykiety */
        padding: 10px;
        font-family: 'Arial', sans-serif; /* Prosta czcionka dla drukarki */
      }
      
      /* Ukrywamy t≈Ça i kolory dla oszczƒôdno≈õci tuszu */
      .login-box, header, .dashboard, .bar-bottom { display: none !important; }
    }

    /* Ukryta etykieta w normalnym widoku (poka≈ºe siƒô w popupie) */
    #printableLabel { display: none; }

    /* --- LOGIN SCREEN --- */
    #loginScreen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999;
      display: flex; align-items: center; justify-content: center; flex-direction: column; transition: opacity 0.8s;
    }
    .login-box {
      width: 450px; padding: 40px; background: rgba(10, 10, 10, 0.95); border: 1px solid var(--neon-cyan);
      text-align: center; border-radius: 12px; position: relative; overflow: hidden;
      box-shadow: 0 0 60px rgba(0, 243, 255, 0.1); backdrop-filter: blur(10px);
    }
    .login-input {
      width: 100%; padding: 15px; margin: 10px 0; background: #080808; border: 1px solid #333; color: var(--neon-cyan);
      font-family: var(--font-tech); font-size: 18px; text-align: center; outline: none; transition: 0.3s;
    }
    .login-input:focus { border-color: var(--neon-cyan); background: #111; }
    .login-btn {
      width: 100%; padding: 15px; margin-top: 20px; background: var(--neon-cyan); color: #000; font-weight: bold; border: none;
      cursor: pointer; font-family: var(--font-tech); transition: 0.3s; font-size: 16px; letter-spacing: 2px;
    }
    .login-btn:hover { background: #fff; box-shadow: 0 0 30px var(--neon-cyan); }

    /* --- NETWORK GUARD --- */
    #networkGuard {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.95); z-index: 8000; backdrop-filter: blur(15px);
      display: none; align-items: center; justify-content: center; flex-direction: column;
    }
    .alert-box { width: 600px; padding: 40px; border: 2px solid var(--neon-red); background: #050505; text-align: center; border-radius: 12px; }
    .guard-btn { width: 100%; padding: 20px; background: var(--neon-red); color: #fff; font-weight: bold; border: none; cursor: pointer; font-family: var(--font-tech); font-size: 18px; margin-top: 20px; }

    /* --- HEADER --- */
    header { height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; background: rgba(0,0,0,0.8); border-bottom: 1px solid #333; }
    .brand { font-family: var(--font-tech); font-size: 28px; font-weight: 700; color: #fff; letter-spacing: 2px; }
    .brand span { color: var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); }
    .operator-info { display: flex; align-items: center; gap: 20px; font-family: var(--font-tech); color: #aaa; font-size: 14px; }
    .operator-badge { background: #1a1a1a; padding: 6px 15px; border-radius: 4px; border: 1px solid #444; color: var(--neon-cyan); font-weight: bold; }
    .operator-badge.admin { border-color: var(--neon-gold); color: var(--neon-gold); }
    .operator-badge.coord { border-color: var(--neon-purple); color: var(--neon-purple); }

    /* --- DASHBOARD --- */
    .dashboard { flex: 1; display: grid; grid-template-columns: 420px 1fr; gap: 20px; padding: 20px; overflow: hidden; opacity: 0; transition: opacity 1s; }
    .panel-left { background: var(--panel-glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; overflow-y: auto; }
    .panel-right { position: relative; background: #000; border: 2px solid #333; border-radius: 12px; overflow: hidden; }
    video { width: 100%; height: 100%; object-fit: contain; }
    .cam-controls { position: absolute; bottom: 20px; right: 20px; z-index: 50; display: flex; gap: 10px; }
    .cam-btn { background: rgba(0,0,0,0.6); border: 1px solid var(--neon-cyan); color: var(--neon-cyan); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; }

    /* UI ELEMENTS */
    .input-label { font-size: 11px; color: var(--neon-cyan); letter-spacing: 1px; margin-bottom: 5px; display: block; font-weight: bold; font-family: var(--font-tech); }
    #scanInput { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 12px; font-size: 22px; text-align: center; font-family: var(--font-tech); outline: none; border-radius: 6px; margin-bottom: 15px; }
    #scanInput:focus { border-color: var(--neon-green); box-shadow: 0 0 20px rgba(10,255,0,0.2); }
    
    .checklist-btn { width: 100%; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.1); color: #888; padding: 12px; margin-bottom: 8px; cursor: pointer; text-align: left; font-family: var(--font-ui); display: flex; justify-content: space-between; transition: 0.2s; font-size: 14px; border-radius: 6px; font-weight: 500; }
    .checklist-btn.done { border-color: var(--neon-green); color: var(--neon-green); background: rgba(10,255,0,0.1); font-weight: 700; }

    .custom-select, .custom-textarea { width: 100%; background: #080808; color: #fff; border: 1px solid #444; padding: 10px; font-family: var(--font-tech); border-radius: 5px; margin-bottom: 10px; }
    .custom-select { border-color: var(--neon-purple); }

    #actionBtn { margin-top: auto; padding: 15px; width: 100%; background: #111; color: #444; font-weight: bold; border: none; font-size: 16px; cursor: not-allowed; border-radius: 6px; font-family: var(--font-tech); }
    #actionBtn.active { background: var(--neon-green); color: #000; cursor: pointer; animation: pulseBtn 2s infinite; }
    @keyframes pulseBtn { 0% { box-shadow: 0 0 10px var(--neon-green); } 50% { box-shadow: 0 0 30px var(--neon-green); } 100% { box-shadow: 0 0 10px var(--neon-green); } }

    /* QR / PRINT POPUP */
    #qrPopup {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: #111; border: 2px solid var(--neon-cyan); padding: 30px; border-radius: 12px; z-index: 500;
      text-align: center; display: none; box-shadow: 0 0 100px rgba(0,0,0,0.9); width: 400px;
    }
    
    /* TO JEST PODGLƒÑD ETYKIETY NA EKRANIE (CIEMNY) */
    .label-preview-box {
      background: #fff; color: #000; padding: 15px; margin: 20px auto;
      border-radius: 4px; width: 300px; text-align: center; font-family: sans-serif;
    }
    
    .print-btn { background: var(--neon-green); color: #000; border: none; padding: 10px 25px; font-weight: bold; cursor: pointer; font-family: var(--font-tech); margin-top: 10px; font-size: 16px; }
    .close-btn { background: #333; color: #fff; border: 1px solid #555; padding: 10px 25px; cursor: pointer; font-family: var(--font-tech); margin-top: 10px; }

    /* PANELS */
    .bar-bottom { position: fixed; bottom: 0; left: 0; width: 100%; height: 40px; background: #080808; border-top: 1px solid #333; display: flex; justify-content: flex-end; padding: 0 20px; gap: 10px; z-index: 100; align-items: center; }
    .bar-btn { background: transparent; border: 1px solid #444; color: #aaa; padding: 5px 15px; font-family: var(--font-tech); font-size: 11px; cursor: pointer; }
    .bar-btn:hover { border-color: var(--neon-cyan); color: var(--neon-cyan); }
    .slide-panel { position: fixed; bottom: 0; left: 0; width: 100%; height: 0; background: rgba(10, 12, 16, 0.98); z-index: 200; transition: height 0.5s; overflow: hidden; border-top: 2px solid var(--neon-cyan); display: flex; flex-direction: column; }
    .slide-panel.open { height: 85vh; }
    
    canvas { display: none; }
  </style>
</head>
<body>

<div id="printableLabel">
  <div style="border: 4px solid black; padding: 10px; width: 350px; text-align: center; margin: 0 auto;">
    <h1 style="margin: 0; font-size: 36px; font-weight: 900;">QC <span id="printStatus">PASS</span></h1>
    <hr style="border: 1px solid black; margin: 10px 0;">
    <div id="printQrCode" style="display:flex; justify-content:center; margin: 10px 0;"></div>
    <div style="font-size: 18px; font-weight: bold; font-family: monospace;" id="printSN">SN: XXXXXXXXX</div>
    <div style="font-size: 12px; margin-top: 5px;">
      <span id="printDate">2023-01-01</span> | OP: <span id="printOp">TEST</span>
    </div>
    <div style="font-size: 10px; margin-top: 5px;">OLED REPAIR CENTER</div>
  </div>
</div>

<div id="loginScreen">
  <div class="login-box">
    <h2 style="color:#fff;">OLED REPAIR SYSTEM</h2>
    <div style="font-size:12px; color:#666; margin-bottom:30px; font-family: var(--font-tech);">V11.0 PRINT MASTER</div>
    <label class="input-label" style="text-align:left;">U≈ªYTKOWNIK</label>
    <input type="text" id="userInput" class="login-input" placeholder="LOGIN">
    <label class="input-label" style="text-align:left; color:var(--neon-red);">HAS≈ÅO</label>
    <input type="password" id="passInput" class="login-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    <div id="loginError" style="color:red; height:20px;"></div>
    <button class="login-btn" onclick="attemptLogin()">ROZPOCZNIJ PRACƒò</button>
  </div>
</div>

<div id="networkGuard">
  <div class="alert-box">
    <h1 style="color:var(--neon-red); margin:0;">‚ö†Ô∏è WYMAGANE PO≈ÅƒÑCZENIE ‚ö†Ô∏è</h1>
    <div style="margin:20px; font-family:var(--font-tech); color:#aaa;">\\plgorfs001\pub\SERVICE\LCDR\LCDR\OLED OBM Panels\Zdjƒôcia z napraw OLED</div>
    <button class="guard-btn" onclick="connectNetwork()">üì° PO≈ÅƒÑCZ Z SERWEREM</button>
  </div>
</div>

<header>
  <div class="brand">LG <span>OLED</span> STUDIO</div>
  <div class="operator-info">
    <div class="operator-badge" id="operatorBadge">---</div>
    <div id="clockDisplay">00:00</div>
  </div>
</header>

<div class="dashboard" id="mainDashboard">
  <aside class="panel-left">
    <div style="text-align:center; margin-bottom:10px;">
      <div style="width:100px; height:60px; background:#111; border:1px solid #333; margin:auto; display:flex; align-items:center; justify-content:center; color:#555;">TV MODEL</div>
    </div>
    
    <span class="input-label">SKANER KOD√ìW KRESKOWYCH</span>
    <input type="text" id="scanInput" placeholder="OCZEKIWANIE NA SKAN..." autofocus>

    <div id="checklist">
      <div id="btnFront" class="checklist-btn" onclick="capture('PRZOD')"><span>1. PRZ√ìD EKRANU</span> <span>üì∑</span></div>
      <div id="btnBack" class="checklist-btn" onclick="capture('TYL')"><span>2. TY≈Å (TABLICZKA)</span> <span>üì∑</span></div>
      <div id="btnImage" class="checklist-btn" onclick="capture('OBRAZ')"><span>3. TEST OBRAZU</span> <span>üì∑</span></div>
    </div>

    <div class="decision-panel">
      <span class="input-label" style="color:var(--neon-purple)">DECYZJA SERWISOWA</span>
      <select id="statusSelect" class="custom-select">
        <option value="OK">üü¢ OK (SPRAWNY)</option>
        <option value="NG">üî¥ NG (USZKODZONY)</option>
        <option value="NDF">üîµ NDF (BRAK WAD)</option>
        <option value="RMA">üü† RMA (ZWROT)</option>
        <option value="SCRAP">‚ö´ SCRAP (Z≈ÅOM)</option>
        <option value="OFFRS_OK">üü£ OFFRS OK</option>
      </select>
      <textarea id="commentInput" class="custom-textarea" rows="2" placeholder="Wpisz uwagi..."></textarea>
    </div>

    <button id="actionBtn" onclick="saveData()">OCZEKIWANIE</button>
    <div id="saveStatus" style="text-align:center; margin-top:5px; font-size:11px; color:#666;"></div>
  </aside>

  <main class="panel-right">
    <div style="position:absolute; top:20px; left:20px;">
      <div class="tag" id="tagSN">SN: ---</div>
    </div>
    <video id="videoFeed" autoplay playsinline></video>
  </main>
</div>

<div class="bar-bottom">
  <div id="connStatus" style="margin-right:auto; font-size:11px; color:#444;">üî¥ OFFLINE</div>
  <button class="bar-btn admin-only" style="display:none;" onclick="toggleUserPanel()">üë• U≈ªYTKOWNICY</button>
  <button class="bar-btn" onclick="location.reload()">WYLOGUJ</button>
</div>

<div id="userPanel" class="slide-panel">
  <div style="padding:20px; background:#000; border-bottom:1px solid #333; display:flex; justify-content:space-between;">
    <span style="color:var(--neon-gold); font-size:20px;">ADMINISTRACJA</span>
    <button class="bar-btn" onclick="toggleUserPanel()">ZAMKNIJ</button>
  </div>
  <div style="padding:20px;">
    <div style="display:flex; gap:10px; margin-bottom:20px;">
      <input id="newLogin" placeholder="Login" style="background:#111; color:#fff; border:1px solid #444; padding:5px;">
      <input id="newPass" placeholder="Has≈Ço" style="background:#111; color:#fff; border:1px solid #444; padding:5px;">
      <select id="newRole" style="background:#111; color:#fff; border:1px solid #444; padding:5px;">
        <option value="OPERATOR">OPERATOR</option>
        <option value="KOORDYNATOR">KOORDYNATOR</option>
        <option value="ADMIN">ADMIN</option>
      </select>
      <button onclick="addUser()" style="background:var(--neon-gold); border:none; cursor:pointer; font-weight:bold;">DODAJ</button>
    </div>
    <div id="userList" style="color:#aaa;"></div>
  </div>
</div>

<div id="qrPopup">
  <h2 style="color:var(--neon-green); font-family:var(--font-tech); margin-top:0;">SUKCES! GOTOWE DO DRUKU</h2>
  
  <div class="label-preview-box">
    <h1 style="margin:0; font-size:28px;">QC PASS</h1>
    <div id="previewQr" style="display:flex; justify-content:center; margin:10px 0;"></div>
    <div style="font-weight:bold;" id="previewSN">SN: XXXXXX</div>
  </div>

  <button class="print-btn" onclick="printLabel()">üñ®Ô∏è DRUKUJ NAKLEJKƒò</button>
  <button class="close-btn" onclick="closeQr()">ZAMKNIJ</button>
</div>

<canvas id="photoCanvas"></canvas>

<script>
  /* --- CONFIG --- */
  const CONFIG = {
    networkPath: String.raw`\\plgorfs001\pub\SERVICE\LCDR\LCDR\OLED OBM Panels\Zdjƒôcia z napraw OLED`,
    defaultUsers: [
      { login: "DAWID", pass: "OLED12345!", role: "OPERATOR" },
      { login: "LUKASZ", pass: "050699", role: "ADMIN" },
      { login: "MICHAL", pass: "COORD2024", role: "KOORDYNATOR" }
    ]
  };

  let users = [];
  let currentUser = null;
  let dirHandle = null;
  let currentSN = "";
  let photos = { PRZOD: null, TYL: null, OBRAZ: null };

  /* --- INIT --- */
  window.onload = () => {
    loadUsers();
    setInterval(() => document.getElementById('clockDisplay').innerText = new Date().toLocaleTimeString().slice(0,5), 1000);
  };

  /* --- USERS --- */
  function loadUsers() {
    const s = localStorage.getItem('oled_users');
    users = s ? JSON.parse(s) : CONFIG.defaultUsers;
  }
  function saveUsers() { localStorage.setItem('oled_users', JSON.stringify(users)); renderUsers(); }
  function attemptLogin() {
    const l = document.getElementById('userInput').value.trim().toUpperCase();
    const p = document.getElementById('passInput').value.trim();
    const u = users.find(x => x.login === l && x.pass === p);
    if(u) {
      currentUser = u;
      document.getElementById('loginScreen').style.opacity = 0;
      setTimeout(() => {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('networkGuard').style.display = 'flex';
        document.getElementById('mainDashboard').style.opacity = 1;
        setupUI();
      }, 800);
    } else { document.getElementById('loginError').innerText = "B≈ÇƒÖd logowania"; }
  }
  function setupUI() {
    document.getElementById('operatorBadge').innerText = currentUser.login;
    const b = document.getElementById('operatorBadge');
    b.className = "operator-badge";
    if(currentUser.role === 'ADMIN') { b.classList.add('admin'); document.querySelector('.admin-only').style.display = 'block'; renderUsers(); }
    if(currentUser.role === 'KOORDYNATOR') b.classList.add('coord');
  }
  function addUser() {
    const l = document.getElementById('newLogin').value.toUpperCase();
    const p = document.getElementById('newPass').value;
    const r = document.getElementById('newRole').value;
    if(l && p) { users.push({login:l, pass:p, role:r}); saveUsers(); }
  }
  function renderUsers() {
    let h = "";
    users.forEach((u,i) => h += `<div>${u.login} [${u.role}] <button onclick="users.splice(${i},1);saveUsers()">X</button></div>`);
    document.getElementById('userList').innerHTML = h;
  }
  function toggleUserPanel() { document.getElementById('userPanel').classList.toggle('open'); }

  /* --- NETWORK --- */
  async function connectNetwork() {
    try {
      await navigator.clipboard.writeText(CONFIG.networkPath);
      dirHandle = await window.showDirectoryPicker();
      document.getElementById('networkGuard').style.display = 'none';
      document.getElementById('connStatus').innerText = "üü¢ PO≈ÅƒÑCZONO Z SIECIƒÑ";
      document.getElementById('connStatus').style.color = "var(--neon-green)";
      initCamera();
      document.getElementById('scanInput').focus();
    } catch(e) { alert("Wybierz folder!"); }
  }

  /* --- CAMERA & LOGIC --- */
  async function initCamera() {
    try {
      const s = await navigator.mediaDevices.getUserMedia({video:{width:{ideal:3840}, height:{ideal:2160}}});
      document.getElementById('videoFeed').srcObject = s;
    } catch(e) { alert("Brak kamery"); }
  }

  document.getElementById('scanInput').addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      const v = e.target.value.trim().toUpperCase();
      if(v.length > 3) startSession(v);
      e.target.value = ""; e.target.blur();
    }
  });

  function startSession(sn) {
    currentSN = sn; photos = { PRZOD: null, TYL: null, OBRAZ: null };
    document.getElementById('tagSN').innerText = "SN: " + sn;
    document.querySelectorAll('.checklist-btn').forEach(b => b.classList.remove('done'));
    document.getElementById('actionBtn').innerText = "OCZEKIWANIE (0/3)";
    document.getElementById('actionBtn').classList.remove('active');
  }

  function capture(type) {
    if(!currentSN) return document.getElementById('scanInput').focus();
    const v = document.getElementById('videoFeed');
    const c = document.getElementById('photoCanvas');
    const x = c.getContext('2d');
    c.width = v.videoWidth; c.height = v.videoHeight;
    x.drawImage(v, 0, 0);
    
    // Watermark
    const fs = Math.floor(c.height/30);
    x.font = `bold ${fs}px Roboto`; x.fillStyle="#0aff00"; x.strokeStyle="black"; x.lineWidth=4;
    x.strokeText(`SN: ${currentSN}`, 50, fs+20); x.fillText(`SN: ${currentSN}`, 50, fs+20);
    
    c.toBlob(b => {
      photos[type] = b;
      const count = Object.values(photos).filter(o=>o).length;
      document.getElementById('actionBtn').innerText = `BRAK ZDJƒòƒÜ (${count}/3)`;
      const map = {'PRZOD':'btnFront','TYL':'btnBack','OBRAZ':'btnImage'};
      document.getElementById(map[type]).classList.add('done');
      if(count===3) {
        document.getElementById('actionBtn').classList.add('active');
        document.getElementById('actionBtn').innerText = "üíæ ZAPISZ";
      }
    }, 'image/jpeg', 0.9);
  }

  async function saveData() {
    if(!document.getElementById('actionBtn').classList.contains('active')) return;
    document.getElementById('saveStatus').innerText = "ZAPISYWANIE...";
    
    const decision = document.getElementById('statusSelect').value;
    const txt = `SN: ${currentSN}\nOP: ${currentUser.login}\nDEC: ${decision}\nDATE: ${new Date().toLocaleString()}`;

    if(dirHandle) {
      try {
        const d = await dirHandle.getDirectoryHandle(currentSN, {create:true});
        await write(d, `${currentSN}_PRZOD.jpg`, photos.PRZOD);
        await write(d, `${currentSN}_TYL.jpg`, photos.TYL);
        await write(d, `${currentSN}_OBRAZ.jpg`, photos.OBRAZ);
        await write(d, `RAPORT_${currentSN}.txt`, new Blob([txt],{type:'text/plain'}));
        
        document.getElementById('saveStatus').innerText = "ZAPISANO!";
        document.getElementById('saveStatus').style.color = "#0aff00";
        
        // POKA≈ª OKNO DRUKOWANIA
        preparePrint(currentSN, decision);
        
      } catch(e) { alert("B≈ÇƒÖd zapisu!"); }
    }
  }
  async function write(dh, n, b) { const h = await dh.getFileHandle(n,{create:true}); const w = await h.createWritable(); await w.write(b); await w.close(); }

  /* --- PRINTING MODULE --- */
  function preparePrint(sn, status) {
    const shortStatus = (status === 'OK' || status === 'OFFRS_OK' || status === 'NDF') ? 'PASS' : 'FAIL';
    
    // Generuj QR dla podglƒÖdu
    document.getElementById('previewQr').innerHTML = "";
    new QRCode(document.getElementById('previewQr'), { text: sn, width: 100, height: 100 });
    document.getElementById('previewSN').innerText = "SN: " + sn;
    
    // Generuj QR dla DRUKU (Ukryty element)
    document.getElementById('printQrCode').innerHTML = "";
    new QRCode(document.getElementById('printQrCode'), { text: sn, width: 128, height: 128 });
    
    // Wype≈Çnij dane druku
    document.getElementById('printStatus').innerText = shortStatus;
    document.getElementById('printSN').innerText = "SN: " + sn;
    document.getElementById('printDate').innerText = new Date().toLocaleDateString();
    document.getElementById('printOp').innerText = currentUser.login;

    document.getElementById('qrPopup').style.display = "block";
  }

  function printLabel() {
    window.print(); // To uruchamia styl @media print
  }

  function closeQr() {
    document.getElementById('qrPopup').style.display = "none";
    currentSN = ""; startSession(""); document.getElementById('scanInput').focus();
  }
</script>
</body>
</html>
